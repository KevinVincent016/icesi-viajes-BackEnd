<?xml version="1.0" encoding="UTF-8"?>
<entity-mappings xmlns="http://xmlns.jcp.org/xml/ns/persistence/orm"
                 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence/orm
		http://xmlns.jcp.org/xml/ns/persistence/orm_2_2.xsd" version="2.2">

    <entity class="co.edu.icesi.viajes.domain.TipoIdentificacion">

        <named-native-query name="TipoIdentificacion.consultarTipoIdentificacionPorEstado" result-set-mapping="consultarTipoIdentificacionPorEstado">
            <query>

                SELECT id_tiid,
                codigo,
                nombre,
                estado
                FROM tipo_identificacion
                WHERE estado = :pEstado
                ORDER BY nombre ASC


            </query>
        </named-native-query>
        <named-native-query name="TipoIdentificacion.consultarTipoIdentificacionPorCodigoYEstado" result-set-mapping="consultarTipoIdentificacionPorCodigoYEstado">
            <query>

                SELECT id_tiid,
                codigo,
                nombre,
                estado
                FROM tipo_identificacion
                WHERE codigo = :pCodigo
                AND estado = :pEstado


            </query>
        </named-native-query>
    </entity>
    <entity class="co.edu.icesi.viajes.domain.Destino">

        <named-native-query name="Destino.consultarDestinosYPlanesAsociadosYValor" result-set-mapping="consultarDestinosYPlanesAsociadosYValor">
            <query>

                SELECT
                d.nombre,
                d.descripcion,
                COUNT(p.id_plan) AS total_planes,
                AVG(p.valor) AS promedio_valor_plan
                FROM
                destino d
                JOIN
                detalle_plan p ON d.id_dest = p.id_dest
                WHERE
                d.estado = 'A'
                GROUP BY
                d.nombre, d.descripcion
                ORDER BY
                total_planes DESC;


            </query>
        </named-native-query>
    </entity>
    <entity class="co.edu.icesi.viajes.domain.Cliente">

        <named-native-query name="Cliente.consultarClientesSegunCriterios" result-set-mapping="consultarClientesSegunCriterios">
            <query>

                SELECT c.estado,
                c.numero_identificacion,
                c.id_tiid,
                c.nombre
                FROM cliente c
                WHERE (:pEstado IS NULL OR estado LIKE '%' || :pEstado || '%')
                AND (:pNumeroIdentificacion IS NULL OR numero_identificacion LIKE '%' || :pNumeroIdentificacion || '%')
                AND (:pTipoIdentificacion IS NULL OR id_tiid = :pTipoIdentificacion)
                AND (:pNombre IS NULL OR nombre LIKE '%' || :pNombre || '%')
                ORDER BY nombre ASC;


            </query>
        </named-native-query>
    </entity>

</entity-mappings>